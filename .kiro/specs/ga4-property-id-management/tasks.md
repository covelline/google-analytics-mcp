# 実装計画

- [ ] 1. プロジェクト準備
  - [ ] 1.1 Google Analytics Adminライブラリの追加
    - requirements.txtにgoogle-analytics-adminを追加
    - 依存関係のインポートを追加
    - _要件: 1.1_
  
  - [ ] 1.2 既存コードの分析
    - プロパティID使用箇所の特定
    - 修正が必要な関数の特定
    - _要件: 1.1, 3.1_

- [ ] 2. GA4プロパティ管理モジュールの実装
  - [ ] 2.1 GA4PropertyManagerクラスの作成
    - クラス構造の実装
    - 初期化メソッドの実装
    - Admin APIクライアントの初期化
    - _要件: 1.1, 1.2_
  
  - [ ] 2.2 プロパティ一覧取得機能の実装
    - list_properties関数の実装
    - プロパティ情報のキャッシュ機能の実装
    - エラーハンドリングの実装
    - _要件: 1.2, 1.3, 4.1, 4.2_
  
  - [ ] 2.3 プロパティ情報取得機能の実装
    - get_property_info関数の実装
    - プロパティIDの検証機能の実装
    - エラーハンドリングの実装
    - _要件: 1.3, 2.5, 4.2_

- [ ] 3. MCPツールの拡張
  - [ ] 3.1 プロパティ管理モジュールの初期化
    - OAuth2認証後の初期化処理の追加
    - グローバル変数の設定
    - _要件: 1.1, 1.2_
  
  - [ ] 3.2 プロパティ一覧取得ツールの実装
    - list_ga4_properties関数の実装
    - ドキュメントとエラーハンドリングの追加
    - _要件: 2.1, 2.4_
  
  - [ ] 3.3 プロパティ情報取得ツールの実装
    - get_ga4_property_info関数の実装
    - ドキュメントとエラーハンドリングの追加
    - _要件: 2.5_

- [ ] 4. 既存GA4データ取得ツールの修正
  - [ ] 4.1 get_ga4_data関数の修正
    - プロパティIDを必須パラメータとして追加
    - パラメータのドキュメント更新
    - _要件: 3.1, 3.2_
  
  - [ ] 4.2 プロパティID検証の追加
    - プロパティIDの検証ロジックの追加
    - 無効なプロパティIDのエラーハンドリング
    - 有効なプロパティIDの一覧提供
    - _要件: 3.3, 3.4_
  
  - [ ] 4.3 GA4 APIリクエストの修正
    - プロパティIDを使用するようにリクエスト作成を修正
    - エラーハンドリングの強化
    - _要件: 3.2, 3.5_

- [ ] 5. OAuth2スコープの拡張
  - [ ] 5.1 必要なスコープの追加
    - Google Analytics Admin APIのスコープを追加
    - スコープ変数の更新
    - _要件: 1.1_
  
  - [ ] 5.2 認証フローの更新
    - 拡張されたスコープでの認証フローの更新
    - エラーハンドリングの強化
    - _要件: 1.1, 5.1_

- [ ] 6. エラー処理の強化
  - [ ] 6.1 Google Analytics Adminライブラリ関連のエラー処理
    - ライブラリ不足時のエラーメッセージ改善
    - インストール方法の案内
    - _要件: 5.1, 5.5_
  
  - [ ] 6.2 プロパティ一覧取得エラーの処理
    - API制限やネットワークエラーの処理
    - ユーザーへのフィードバック改善
    - _要件: 1.4, 5.2, 5.5_
  
  - [ ] 6.3 無効なプロパティIDのエラー処理
    - 明確なエラーメッセージの提供
    - 有効なプロパティIDの一覧提供
    - _要件: 2.4, 3.4, 5.5_

- [ ] 7. ドキュメントとコメントの更新
  - [ ] 7.1 新しいツールのドキュメント
    - list_ga4_propertiesのドキュメント作成
    - get_ga4_property_infoのドキュメント作成
    - _要件: 2.1, 2.5_
  
  - [ ] 7.2 修正されたツールのドキュメント更新
    - get_ga4_dataのドキュメント更新
    - プロパティID必須の明記
    - _要件: 3.1_
  
  - [ ] 7.3 コードコメントの追加
    - 新しいクラスと関数のコメント追加
    - 修正箇所の説明コメント追加
    - _要件: 全般_

- [ ] 8. テストとデバッグ
  - [ ] 8.1 プロパティ管理モジュールのテスト
    - プロパティ一覧取得のテスト
    - プロパティ情報取得のテスト
    - エラーケースのテスト
    - _要件: 1.2, 1.3, 1.4_
  
  - [ ] 8.2 修正されたGA4データ取得のテスト
    - 有効なプロパティIDでのデータ取得テスト
    - 無効なプロパティIDでのエラー処理テスト
    - _要件: 3.2, 3.3, 3.4_
  
  - [ ] 8.3 OAuth2スコープ拡張のテスト
    - 拡張されたスコープでの認証フローテスト
    - 権限不足時のエラー処理テスト
    - _要件: 1.1, 5.1_